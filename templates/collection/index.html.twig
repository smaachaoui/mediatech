{% extends 'base.html.twig' %}

{% block title %}Nos collections | MediaTech{% endblock %}

{% block body %}

<div class="d-flex flex-column gap-3">

  <section class="bg-white border rounded-3 p-3">
    <h1 class="h4 mb-1">Découvrez nos collections</h1>
    <p class="text-muted mb-0">Parcourez les collections publiées par la communauté.</p>
  </section>

  <section class="bg-white border rounded-3 p-3">
    <div class="row g-4">

      <aside class="col-12 col-lg-3">
        <div class="border rounded-3 p-3">
          <h2 class="h6 mb-3">Filtrer</h2>

          <form method="get" action="{{ path('app_collections_public') }}" id="filterForm">
            <div class="mb-3">
              <label class="form-label small fw-semibold">Type de média</label>
              <select class="form-select" name="type" onchange="this.form.submit()">
                <option value="all" {{ filters.type == 'all' ? 'selected' : '' }}>Tout afficher</option>
                <option value="book" {{ filters.type == 'book' ? 'selected' : '' }}>Livres uniquement</option>
                <option value="movie" {{ filters.type == 'movie' ? 'selected' : '' }}>Films uniquement</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label small fw-semibold">Trier par</label>
              <select class="form-select" name="sort" onchange="this.form.submit()">
                <option value="new" {{ filters.sort == 'new' ? 'selected' : '' }}>Plus récentes</option>
                <option value="old" {{ filters.sort == 'old' ? 'selected' : '' }}>Plus anciennes</option>
                <option value="alpha" {{ filters.sort == 'alpha' ? 'selected' : '' }}>A à Z</option>
              </select>
            </div>

            <input type="hidden" name="page" value="1">

            <hr class="my-3">

            <div class="d-grid gap-2">
              <a class="btn btn-outline-secondary btn-sm" href="{{ path('app_collections_public') }}">
                Réinitialiser les filtres
              </a>
            </div>
          </form>

          <hr class="my-3">

          <div class="mb-2">
            <label class="form-label small fw-semibold">Affichage</label>
          </div>
          <div class="btn-group w-100" role="group" aria-label="Mode d'affichage">
            <button type="button" class="btn btn-outline-secondary btn-sm active" id="btnGrid" onclick="setViewMode('grid')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z"/>
              </svg>
              Grille
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" id="btnList" onclick="setViewMode('list')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
              </svg>
              Liste
            </button>
          </div>

        </div>
      </aside>

      <div class="col-12 col-lg-9">

        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="h6 mb-0">
            Collections
            <span class="badge bg-secondary ms-1">{{ total }}</span>
          </h3>
        </div>

        {% if collections is not empty %}

          <div class="row g-3 view-grid" id="collectionsGridView">
            {% for collection in collections %}
              <div class="col-12 col-md-6 col-xl-4">
                {% include 'components/_structure_collection_grid.html.twig' with {
                  collection: collection,
                  context: 'public',
                  showOwner: true,
                  showActions: false,
                  showVisibilityBadge: true
                } %}
              </div>
            {% endfor %}
          </div>

          <div class="d-flex flex-column gap-2 view-list d-none" id="collectionsListView">
            {% for collection in collections %}
              {% include 'components/_structure_collection_list.html.twig' with {
                collection: collection,
                context: 'public',
                showOwner: true,
                showActions: false,
                showVisibilityBadge: true
              } %}
            {% endfor %}
          </div>

          {% if totalPages > 1 %}
            <div class="mt-4">
              {% include 'components/_nav_pagination.html.twig' with {
                route: 'app_collections_public',
                page: page,
                totalPages: totalPages,
                query: {
                  type: filters.type,
                  sort: filters.sort
                }
              } %}
            </div>
          {% endif %}

        {% else %}
          {% include 'components/_state_empty.html.twig' with {
            title: 'Aucune collection trouvée',
            message: 'Essayez de modifier les filtres pour élargir les résultats.'
          } %}
        {% endif %}

      </div>
    </div>
  </section>

</div>

{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
  function setViewMode(mode) {
    const btnGrid = document.getElementById('btnGrid');
    const btnList = document.getElementById('btnList');
    const gridViews = document.querySelectorAll('.view-grid');
    const listViews = document.querySelectorAll('.view-list');

    if (mode === 'list') {
      btnList.classList.add('active');
      btnGrid.classList.remove('active');
      gridViews.forEach(el => el.classList.add('d-none'));
      listViews.forEach(el => el.classList.remove('d-none'));
      localStorage.setItem('collectionsViewMode', 'list');
    } else {
      btnGrid.classList.add('active');
      btnList.classList.remove('active');
      gridViews.forEach(el => el.classList.remove('d-none'));
      listViews.forEach(el => el.classList.add('d-none'));
      localStorage.setItem('collectionsViewMode', 'grid');
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const savedMode = localStorage.getItem('collectionsViewMode');
    if (savedMode) {
      setViewMode(savedMode);
    }
  });
</script>
{% endblock %}