{% extends 'dashboard/_layout.html.twig' %}

{% block title %}Admin | Commentaires{% endblock %}

{% block dashboard_sidebar %}
  {% include 'admin/partials/_sidebar.html.twig' with { section: 'comments' } %}
{% endblock %}

{% block dashboard_content %}
  <div class="d-flex justify-content-between align-items-start gap-3 mb-3">
    <div>
      <h1 class="h3 mb-1">Commentaires</h1>
      <div class="text-muted">Modération des derniers commentaires publiés.</div>
    </div>
  </div>

  <div class="card border rounded-3">
    <div class="card-body">

      {% if comments is empty %}
        <div class="text-muted">Aucun commentaire.</div>
      {% else %}
        <div class="d-flex flex-column gap-3">
          {% for comment in comments %}
            <div class="border rounded-3 p-3">
              <div class="d-flex justify-content-between align-items-start gap-3">
                <div>
                  <div class="fw-semibold">
                    {% if comment.user %}
                      {{ comment.user.pseudo ?? comment.user.email }}
                    {% else %}
                      {{ comment.guestName ?? 'Invité' }}
                    {% endif %}
                  </div>

                  <div class="text-muted small">
                    {% if comment.createdAt %}
                      {{ comment.createdAt|date('d/m/Y H:i') }}
                    {% else %}
                      —
                    {% endif %}
                    <span class="mx-2">•</span>
                    <a class="text-decoration-none" href="{{ path('app_collection_show', { id: comment.collection.id }) }}">
                      Voir la collection
                    </a>
                  </div>
                </div>

                <form method="post" action="{{ path('admin_comments_delete', { id: comment.id }) }}">
                  <input type="hidden" name="_token" value="{{ csrf_token('admin_delete_comment_' ~ comment.id) }}">
                  <button type="submit" class="btn btn-outline-danger btn-sm"
                          onclick="return confirm('Supprimer ce commentaire ?');">
                    Supprimer
                  </button>
                </form>
              </div>

              <div class="text-muted mt-2">
                {{ comment.content }}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

    </div>
  </div>
{% endblock %}
