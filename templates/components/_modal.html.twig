{# templates/components/_modal.html.twig #}

{% set id = id ?? 'modal' %}
{% set title = title ?? '' %}
{% set size = size ?? '' %}
{% set useBlocks = use_blocks|default(false) %}
{% set useSymfonyForm = use_symfony_form|default(false) %}
{% set dialogClass = 'modal-dialog modal-dialog-centered' ~ (size ? ' modal-' ~ size : '') %}

<div class="modal fade"
     id="{{ id }}"
     tabindex="-1"
     aria-labelledby="{{ id }}Label"
     aria-hidden="true">
  <div class="{{ dialogClass }}">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="{{ id }}Label">{{ title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>

      {# ✅ MODE SYMFONY FORM : uniquement si demandé explicitement #}
      {% if useSymfonyForm and form is defined %}
        {{ form_start(form, { action: action|default(null), attr: form_attr|default({}) }) }}
          <div class="modal-body">
            {{ block('body') }}
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Annuler
            </button>

            <button type="submit" class="btn {{ submit_class|default('btn-primary') }}">
              {{ submit_label|default('Valider') }}
            </button>

            {{ block('footer') }}
          </div>
        {{ form_end(form) }}

      {# MODE 1 : Modal avec formulaire "manuel" (action) #}
      {% elseif action is defined %}
        <form method="post" action="{{ action }}">
          <div class="modal-body">
            {% if csrf_id is defined %}
              <input type="hidden" name="_token" value="{{ csrf_token(csrf_id) }}">
            {% endif %}

            {{ block('body') }}
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Annuler
            </button>

            <button type="submit" class="btn {{ submit_class|default('btn-primary') }}">
              {{ submit_label|default('Valider') }}
            </button>

            {{ block('footer') }}
          </div>
        </form>

      {# MODE 1bis : Modal sans form, contenu via blocks (embed) #}
      {% elseif useBlocks %}
        <div class="modal-body">
          {{ block('body') }}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Fermer
          </button>

          {{ block('footer') }}
        </div>

      {# MODE 2 : Modal avec variables body/footer #}
      {% else %}
        <div class="modal-body">
          {% if body is defined %}
            {{ body|raw }}
          {% endif %}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Annuler
          </button>

          {% if footer is defined %}
            {{ footer|raw }}
          {% endif %}
        </div>
      {% endif %}

    </div>
  </div>
</div>

{% block body %}{% endblock %}
{% block footer %}{% endblock %}
