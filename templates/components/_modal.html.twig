{# templates/components/_modal.html.twig

   Ce composant supporte deux modes d'utilisation :

   MODE 1 - Avec embed et blocs (pour les formulaires complexes) :
   {% embed 'components/_modal.html.twig' with {
     id: 'myModal',
     title: 'Mon titre',
     action: path('my_route'),
     csrf_id: 'my_csrf_token',
     submit_label: 'Valider',
     submit_class: 'btn-primary'
   } %}
     {% block body %}
       <p>Mon contenu ici</p>
     {% endblock %}
   {% endembed %}

   MODE 2 - Avec include et variables (pour les confirmations simples) :
   {% include 'components/_modal.html.twig' with {
     id: 'myModal',
     title: 'Mon titre',
     body: '<p>Mon contenu HTML</p>',
     footer: '<form>...</form>',
     allow_raw_body: true,
     allow_raw_footer: true
   } %}
#}

{% set size = size ?? '' %}

<div class="modal fade" id="{{ id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog {{ size }}">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">{{ title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>

      {# MODE 1 : Utilisation avec embed et formulaire integre #}
      {% if action is defined %}
        <form method="post" action="{{ action }}">
          <div class="modal-body">
            {% if csrf_id is defined %}
              <input type="hidden" name="_token" value="{{ csrf_token(csrf_id) }}">
            {% endif %}
            {% block body %}{% endblock %}
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Annuler
            </button>
            <button type="submit" class="btn {{ submit_class|default('btn-primary') }}">
              {{ submit_label|default('Valider') }}
            </button>
            {% block footer %}{% endblock %}
          </div>
        </form>

      {# MODE 2 : Utilisation avec include et variables body/footer #}
      {% else %}
        {% set allowRawBody = allow_raw_body|default(false) %}
        {% set allowRawFooter = allow_raw_footer|default(false) %}

        <div class="modal-body">
          {% if allowRawBody %}
            {{ body|default('')|raw }}
          {% else %}
            {{ body|default('')|e|nl2br }}
          {% endif %}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Annuler
          </button>

          {% if allowRawFooter %}
            {{ footer|default('')|raw }}
          {% else %}
            {{ footer|default('')|e|nl2br }}
          {% endif %}
        </div>
      {% endif %}

    </div>
  </div>
</div>

{# Bloc pour scripts JavaScript additionnels (à placer après la modal) #}
{% block footer_extra %}{% endblock %}