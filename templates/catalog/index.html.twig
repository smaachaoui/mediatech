{% extends 'base.html.twig' %}

{% block title %}Catalogue | MediaTech{% endblock %}

{% block body %}

{# =======================
   MAIN
   ======================= #}
<div class="d-flex flex-column gap-3">

  {# =======================
     search-section
     (titre + barre de recherche)
     ======================= #}
  <section class="bg-white border rounded-3 p-3">
    <h1 class="h5 mb-3 text-center">Vous cherchez un livre ou un film ?</h1>

    <form method="get" action="{{ path('app_catalog') }}" class="row g-2 align-items-center">
      <div class="col-12 col-md">
        <div class="input-group">
          <span class="input-group-text" aria-hidden="true">üîé</span>
          <input
            type="search"
            name="q"
            value="{{ q }}"
            class="form-control"
            placeholder="Titre, auteur, r√©alisateur..."
          >
        </div>
      </div>

      {# on conserve les filtres #}
      <input type="hidden" name="type" value="{{ type }}">
      <input type="hidden" name="sort" value="{{ sort }}">

      <div class="col-12 col-md-auto">
        <button class="btn btn-primary w-100" type="submit">Rechercher</button>
      </div>
    </form>
  </section>

  {# =======================
     results-section
     (aside filtres + r√©sultats)
     ======================= #}
  <section class="bg-white border rounded-3 p-3">

    <div class="row g-4">

      {# ASIDE filtres (wireframe) #}
      <aside class="col-12 col-lg-3">
        <div class="border rounded-3 p-3">
          <h2 class="h6 mb-3">Filtrer</h2>

          <form method="get" action="{{ path('app_catalog') }}">
            <div class="mb-3">
              <label class="form-label">Type</label>
              <select class="form-select" name="type">
                <option value="all"  {{ type == 'all' ? 'selected' : '' }}>Tout</option>
                <option value="book" {{ type == 'book' ? 'selected' : '' }}>Livres</option>
                <option value="movie" {{ type == 'movie' ? 'selected' : '' }}>Films</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Tri</label>
              <select class="form-select" name="sort">
                <option value="recent" {{ sort == 'recent' ? 'selected' : '' }}>Les plus r√©cents</option>
                <option value="title"  {{ sort == 'title' ? 'selected' : '' }}>Titre A ‚Üí Z</option>
              </select>
            </div>

            {# on conserve la recherche si pr√©sente #}
            {% if q %}
              <input type="hidden" name="q" value="{{ q }}">
            {% endif %}

            <div class="d-grid gap-2">
              <button class="btn btn-dark" type="submit">Appliquer</button>
              <a class="btn btn-outline-secondary" href="{{ path('app_catalog') }}">R√©initialiser</a>
            </div>
          </form>
        </div>
      </aside>

      {# ZONE r√©sultats #}
      <div class="col-12 col-lg-9">

        {% set hasAny = (books|length) + (movies|length) > 0 %}

        {% if not hasAny %}
          {% include 'components/_state_empty.html.twig' with {
            title: 'Aucun r√©sultat',
            message: 'Essayez de modifier vos filtres ou votre recherche.'
          } %}
        {% else %}

          {# Si "all", on affiche deux blocs (MVP). Si "book" ou "movie", un seul bloc. #}

          {% if type in ['all','book'] %}
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h3 class="h6 mb-0">Livres</h3>
            </div>

            <div class="row g-3 mb-4">
              {% for book in books %}
                <div class="col-6 col-md-4 col-lg-3">
                  {% include 'components/_structure_media.html.twig' with { item: book, kind: 'book' } %}
                </div>
              {% endfor %}
            </div>
          {% endif %}

          {% if type in ['all','movie'] %}
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h3 class="h6 mb-0">Films</h3>
            </div>

            <div class="row g-3">
              {% for movie in movies %}
                <div class="col-6 col-md-4 col-lg-3">
                  {% include 'components/_structure_media.html.twig' with { item: movie, kind: 'movie' } %}
                </div>
              {% endfor %}
            </div>
          {% endif %}

          {# Pagination (MVP visuelle) #}
          <div class="mt-4">
            {% include 'components/_nav_pagination.html.twig' with {
              page: page,
              hasPrev: page > 1,
              hasNext: (books|length == perPage) or (movies|length == perPage),
              route: 'app_catalog',
              params: { type: type, sort: sort, q: q }
            } %}
          </div>

        {% endif %}
      </div>

    </div>
  </section>

</div>

{% endblock %}
