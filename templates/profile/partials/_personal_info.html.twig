<div class="d-flex justify-content-between align-items-start gap-3 mb-3">
  <div>
    <h1 class="h3 mb-1">Informations personnelles</h1>
    <div class="text-muted">Gérez vos informations de profil et vos préférences.</div>
  </div>
</div>

<div class="row g-4">

  <div class="col-12 col-lg-4">
    <div class="card border rounded-3">
      <div class="card-body text-center">

        <div class="mb-3">
          <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center border overflow-hidden"
               style="width: 120px; height: 120px; font-size: 3rem;">
            {% if user.profilePicture %}
              <img src="{{ asset(user.profilePicture) }}" 
                   alt="Photo de profil" 
                   class="w-100 h-100"
                   style="object-fit: cover;">
            {% else %}
              <span class="text-muted">{{ user.pseudo|first|upper }}</span>
            {% endif %}
          </div>
        </div>

        <h2 class="h5 mb-1">{{ user.pseudo }}</h2>
        <div class="text-muted small mb-3">{{ user.email }}</div>

        <div class="text-muted small">
          Membre depuis le {{ user.createdAt|date('d/m/Y') }}
        </div>

      </div>
    </div>
  </div>

  <div class="col-12 col-lg-8">
    <div class="card border rounded-3">
      <div class="card-body">

        <div class="mb-4">
          <div class="text-muted small mb-1">Pseudo</div>
          <div class="fw-semibold">{{ user.pseudo }}</div>
        </div>

        <div class="mb-4">
          <div class="text-muted small mb-1">Email</div>
          <div>{{ user.email }}</div>
        </div>

        <div class="mb-4">
          <div class="text-muted small mb-1">Biographie</div>
          {% if user.biography %}
            <div>{{ user.biography }}</div>
          {% else %}
            <div class="text-muted fst-italic">Aucune biographie renseignée.</div>
          {% endif %}
        </div>

        <div class="mb-4">
          <div class="text-muted small mb-2">Genres favoris</div>
          {% if user.favoriteGenres is defined and user.favoriteGenres|length > 0 %}
            <div class="d-flex flex-wrap gap-2">
              {% for genre in user.favoriteGenres %}
                <span class="badge {{ genre.type == 'book' ? 'text-bg-primary' : 'text-bg-success' }}">
                  {{ genre.name }}
                </span>
              {% endfor %}
            </div>
          {% else %}
            <div class="text-muted fst-italic">Aucun genre favori sélectionné.</div>
          {% endif %}
        </div>

        <hr class="my-4">

        <div class="d-flex flex-wrap gap-2">
          <button type="button" 
                  class="btn btn-primary"
                  data-bs-toggle="modal" 
                  data-bs-target="#editProfileModal">
            Modifier le profil
          </button>

          <a href="{{ path('app_forgot_password_request') }}" class="btn btn-outline-secondary">
            Changer le mot de passe
          </a>

          {% if user.profilePicture %}
            <button type="button" 
                    class="btn btn-outline-danger"
                    data-bs-toggle="modal" 
                    data-bs-target="#removePictureModal">
              Supprimer la photo
            </button>
          {% endif %}
        </div>

      </div>
    </div>
  </div>

</div>

<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Modifier mon profil</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>

      {{ form_start(editForm, { 'action': path('app_profile_edit'), 'attr': { 'enctype': 'multipart/form-data' } }) }}
        <div class="modal-body">

          <div class="mb-3">
            {{ form_label(editForm.pseudo) }}
            {{ form_widget(editForm.pseudo) }}
            {{ form_errors(editForm.pseudo) }}
            <div class="form-text">Entre 3 et 50 caractères. Lettres, chiffres, tirets et underscores uniquement.</div>
          </div>

          <div class="mb-3">
            {{ form_label(editForm.biography) }}
            {{ form_widget(editForm.biography) }}
            {{ form_errors(editForm.biography) }}
            <div class="form-text">Maximum 500 caractères.</div>
          </div>

          <div class="mb-3">
            {{ form_label(editForm.profilePictureFile) }}
            {{ form_widget(editForm.profilePictureFile) }}
            {{ form_errors(editForm.profilePictureFile) }}
            <div class="form-text">Formats acceptés : JPG, PNG, GIF, WebP. Maximum 2 Mo.</div>
          </div>

          <div class="mb-3">
            <label class="form-label">Genres favoris</label>
            <div class="border rounded p-3" style="max-height: 250px; overflow-y: auto;">
              {{ form_widget(editForm.favoriteGenres, { 'attr': { 'class': 'd-flex flex-wrap gap-3' } }) }}
            </div>
            <div class="form-text">Sélectionnez vos genres préférés pour personnaliser votre expérience.</div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Annuler
          </button>
          <button type="submit" class="btn btn-primary">
            Enregistrer les modifications
          </button>
        </div>
      {{ form_end(editForm) }}

    </div>
  </div>
</div>

{% if user.profilePicture %}
  <div class="modal fade" id="removePictureModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Supprimer la photo de profil</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>

        <div class="modal-body">
          <p>Voulez-vous vraiment supprimer votre photo de profil ?</p>
          <p class="text-muted mb-0">Votre avatar affichera l'initiale de votre pseudo.</p>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Annuler
          </button>
          <form method="post" action="{{ path('app_profile_remove_picture') }}">
            <input type="hidden" name="_token" value="{{ csrf_token('remove_picture') }}">
            <button type="submit" class="btn btn-danger">
              Supprimer la photo
            </button>
          </form>
        </div>

      </div>
    </div>
  </div>
{% endif %}