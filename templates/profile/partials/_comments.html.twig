<div class="d-flex justify-content-between align-items-start gap-3 mb-3">
  <div>
    <h1 class="h3 mb-1">Mes commentaires</h1>
    <div class="text-muted">Consultez et gérez les commentaires que vous avez publiés.</div>
  </div>
</div>

<div class="card border rounded-3">
  <div class="card-body">

    {% if comments is not defined or comments is empty %}
      {% include 'components/_state_empty.html.twig' with {
        title: 'Aucun commentaire',
        message: 'Vous n\'avez pas encore publié de commentaire sur les collections.'
      } only %}
    {% else %}
      <div class="d-flex flex-column gap-3">
        {% for comment in comments %}
          <div class="border rounded-3 p-3">
            <div class="d-flex justify-content-between align-items-start gap-3">

              <div class="flex-grow-1">
                <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
                  {% if comment.collection %}
                    <a href="{{ path('app_collection_show', { id: comment.collection.id }) }}" 
                       class="fw-semibold text-decoration-none">
                      {{ comment.collection.name }}
                    </a>
                  {% else %}
                    <span class="fw-semibold text-muted">Collection supprimée</span>
                  {% endif %}

                  <span class="text-muted small">
                    {{ comment.createdAt ? comment.createdAt|date('d/m/Y à H:i') : '—' }}
                  </span>

                  {% if comment.updatedAt %}
                    <span class="badge text-bg-light">Modifié</span>
                  {% endif %}
                </div>

                <div class="text-muted">
                  {{ comment.content }}
                </div>
              </div>

              <div class="flex-shrink-0">
                <button type="button" 
                        class="btn btn-outline-danger btn-sm"
                        data-bs-toggle="modal" 
                        data-bs-target="#deleteCommentModal_{{ comment.id }}">
                  Supprimer
                </button>
              </div>

            </div>
          </div>

          {% include 'components/_modal.html.twig' with {
            id: 'deleteCommentModal_' ~ comment.id,
            title: 'Supprimer le commentaire',
            body: '
              <p>Voulez-vous vraiment supprimer ce commentaire ?</p>
              <div class="bg-light border rounded p-2 small">
                ' ~ comment.content|e ~ '
              </div>
              <p class="text-danger small mt-2 mb-0">Cette action est définitive.</p>
            ',
            footer: '
              <form method="post" action="' ~ path('app_profile_delete_comment', { id: comment.id }) ~ '">
                <input type="hidden" name="_token" value="' ~ csrf_token('delete_comment_' ~ comment.id) ~ '">
                <button type="submit" class="btn btn-danger">
                  Supprimer définitivement
                </button>
              </form>
            '
          } %}
        {% endfor %}
      </div>

      <div class="mt-3 text-muted small">
        {{ comments|length }} commentaire{{ comments|length > 1 ? 's' : '' }} publié{{ comments|length > 1 ? 's' : '' }}
      </div>
    {% endif %}

  </div>
</div>