{% extends 'base.html.twig' %}

{% block title %}{{ movie.title }} | MediaTech{% endblock %}

{% block body %}
<div class="container py-4">
    <div class="row g-4">

        {# COLONNE GAUCHE : AFFICHE + ACTIONS #}
        <div class="col-12 col-md-4 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    {% if movie.poster %}
                        <img src="{{ movie.poster }}" class="img-fluid rounded-3 border" alt="{{ movie.title }}">
                    {% else %}
                        <div class="d-flex align-items-center justify-content-center bg-body-tertiary border rounded-3" style="height: 360px;">
                            <span class="text-muted">Aucune affiche</span>
                        </div>
                    {% endif %}

                    <div class="mt-3 d-grid gap-2">
                        {% if app.user %}
                            {% set inCollection = is_in_collection('movie', movie.id) %}
                            {% set inWishlist = is_in_wishlist('movie', movie.id) %}

                            {# Bouton collection #}
                            {% if inCollection %}
                                <span class="btn btn-success w-100">
                                    <i class="bi bi-check-lg me-1"></i> Deja dans votre collection
                                </span>
                            {% else %}
                                <form method="post" action="{{ path('app_media_add_to_default', { kind: 'movie', id: movie.id }) }}">
                                    <input type="hidden" name="_token" value="{{ csrf_token('add_media_movie_' ~ movie.id) }}">
                                    <button class="btn btn-primary w-100" type="submit">
                                        <i class="bi bi-plus-lg me-1"></i> Ajouter a ma collection
                                    </button>
                                </form>
                            {% endif %}

                            {# Bouton wishlist #}
                            {% if inWishlist %}
                                <span class="btn btn-success w-100">
                                    <i class="bi bi-heart-fill me-1"></i> Deja dans votre liste d'envies
                                </span>
                            {% else %}
                                <form method="post" action="{{ path('app_media_add_to_wishlist', { kind: 'movie', id: movie.id }) }}">
                                    <input type="hidden" name="_token" value="{{ csrf_token('add_wishlist_movie_' ~ movie.id) }}">
                                    <button class="btn btn-outline-primary w-100" type="submit">
                                        <i class="bi bi-heart me-1"></i> Ajouter a ma liste d'envies
                                    </button>
                                </form>
                            {% endif %}
                        {% else %}
                            <a href="{{ path('app_login') }}" class="btn btn-primary w-100">
                                <i class="bi bi-plus-lg me-1"></i> Ajouter a ma collection
                            </a>
                            <a href="{{ path('app_login') }}" class="btn btn-outline-primary w-100">
                                <i class="bi bi-heart me-1"></i> Ajouter a ma liste d'envies
                            </a>
                        {% endif %}

                        {% set q = app.request.query.get('q') %}
                        {% set type = app.request.query.get('type') %}

                        {% if q %}
                            <a
                                class="btn btn-link text-decoration-none px-0"
                                href="{{ path('app_catalog', { q: q, type: type }) }}"
                            >
                                ← Retour aux résultats
                            </a>
                        {% endif %}

                        <a class="btn btn-link text-decoration-none px-0" href="{{ path('app_catalog') }}">
                            ← Retour au catalogue
                        </a>
                    </div>
                </div>
            </div>
        </div>

        {# COLONNE DROITE : TITRE + SYNOPSIS + DÉTAILS #}
        <div class="col-12 col-md-8 col-lg-9">

            <div class="mb-3">
                <h1 class="h3 mb-0">{{ movie.title }}</h1>
            </div>

            {# SYNOPSIS #}
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-3 p-md-4">
                    <h2 class="h5 mb-3">Synopsis</h2>
                    <div class="text-muted">
                        {{ movie.overview ?: 'Aucun synopsis.' }}
                    </div>
                </div>
            </div>

            {# DÉTAILS #}
            <div class="card border-0 shadow-sm">
                <div class="card-body p-3 p-md-4">
                    <h2 class="h6 text-uppercase text-muted mb-3">Détails</h2>

                    <div class="row g-3">

                        <div class="col-12 col-lg-6">
                            <div class="d-flex justify-content-between align-items-center border rounded-3 p-3 bg-white h-100">
                                <span class="text-muted">Année</span>
                                <span class="fw-semibold">
                                    {{ movie.releaseDate ? movie.releaseDate|slice(0,4) : '—' }}
                                </span>
                            </div>
                        </div>

                        <div class="col-12 col-lg-6">
                            <div class="d-flex justify-content-between align-items-center border rounded-3 p-3 bg-white h-100">
                                <span class="text-muted">Sortie</span>
                                <span class="fw-semibold">
                                    {{ movie.releaseDate ? movie.releaseDate|slice(0,10) : '—' }}
                                </span>
                            </div>
                        </div>

                        <div class="col-12 col-lg-6">
                            <div class="d-flex justify-content-between align-items-center border rounded-3 p-3 bg-white h-100">
                                <span class="text-muted">Genre</span>
                                <span class="fw-semibold text-end">
                                    {% if movie.genres is not empty %}
                                        {{ movie.genres|join(', ') }}
                                    {% else %}
                                        —
                                    {% endif %}
                                </span>
                            </div>
                        </div>

                        <div class="col-12 col-lg-6">
                            <div class="d-flex justify-content-between align-items-center border rounded-3 p-3 bg-white h-100">
                                <span class="text-muted">Réalisateur</span>
                                <span class="fw-semibold text-end">
                                    {{ movie.director ?: '—' }}
                                </span>
                            </div>
                        </div>

                        <div class="col-12 col-lg-6">
                            <div class="d-flex justify-content-between align-items-center border rounded-3 p-3 bg-white h-100">
                                <span class="text-muted">TMDB</span>
                                <span class="fw-semibold">{{ movie.id ?: '—' }}</span>
                            </div>
                        </div>

                        {#
                        <div class="col-12 col-lg-6">
                            <div class="d-flex justify-content-between align-items-center border rounded-3 p-3 bg-white h-100">
                                <span class="text-muted">Durée</span>
                                <span class="fw-semibold">{{ movie.runtime ? movie.runtime ~ ' min' : '—' }}</span>
                            </div>
                        </div>
                        #}

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}